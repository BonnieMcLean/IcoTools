---
title: "R scripts for processing guessing and rating experiment results"
output: html_notebook
---

# Raw results to tidy data

The code below can be used to combine the raw results from a series of guessing or rating tasks into one long tidy dataset. Just change the code where indicated so that it matches your filenames, and the number of experiments you have. I've used triple comment markers to indicate where there is code you need to change, and single comment markers to explain what the code does.

```{r processing rating results}
### CHANGE n_experiments TO THE NUMBER OF EXPERIMENTS YOU HAVE TO PROCESS ###
n_experiments <- 2

### CHANGE THE FILENAME TO THE FILENAME OF YOUR FIRST EXPERIMENT ###
experiments <- read_csv("ratings/experiment1.csv")%>%mutate(experiment=1)

# join all the experiments
for(i in 2:n_experiments){
  next_experiment <-read_csv(paste("ratings/experiment",as.character(i),".csv",sep=''))
  next_experiment%>%
    select(-length(.))%>%
    mutate(experiment=i)->next_experiment
  experiments <- full_join(experiments,next_experiment)
}

# Figure out what the last reaction time column is
last_RT <- tail(colnames(select(experiments,contains("rt"))),1)

# convert to tidy data
experiments%>%
  # in case there are any double submissions
  unique()%>%
  pivot_longer(cols=t1:last_RT,names_to=c(".value","trial"),names_pattern="([A-Za-z]+)(\\d+)")%>%
  rename(trans=t,rating=a)%>%
  # get rid of NAs -- for the experiments that have less trials
  filter(!(is.na(trans)))->experiments

# add identifiers (in the format word_MEANING) for the trials -- this is important in case you have homonyms in your data. I just use the first translation in the meaning column to make these identifiers.

### CHANGE THE FILENAME TO THE FILENAME OF YOUR EXPERIMENT LIST ###
info <- read_csv("ratings/ratingwords_experiments.csv")

info%>%
  rowwise()%>%
  mutate(identifier=paste(form,str_split(meaning,"\\|")[[1]][1],sep="_"))%>%
  select(experiment,trial,form,identifier)->info

info$trial <- as.character(info$trial)

# join to experiment data
experiments%>%
  left_join(info)->experiments
```


```{r processing guessing results}
# use the same code above as for the ratings, then add this to mark the stuff as correct or incorrect

grade_responses <- function(trial,response){
  trial <- as.numeric(trial)
  if(trial%%2==1&response=="A"){return("correct")}
  else if(trial%%2==0&response=="B"){return("correct")}
  else{return("incorrect")}
}

experiments%>%
  rename(response=rating)%>%
  rowwise()%>%
  mutate(grade=grade_responses(trial,response))->experiments
```

# Examining participants answers

```{r examine results}
# first look at task descriptions
experiments%>%
  select(participant,Taskdesc)%>%
  unique()->taskdesc

# then look at their RTs and performance on the control items
### REPLACE THE ITEMS HERE WITH YOUR OWN CONTROL ITEMS ###
controls <- c("fuwafuwa_FLUFFY","yoroyoro_WOBBLING","pyoNpyoN_BOUNCING","hisohiso_WHISPERING","katai_HARD")

groupmeanRT <- mean(experiments$rt)
groupsd <- sd(experiments$rt)
experiments%>%
  mutate(outlier_item=ifelse(abs(rt-groupmeanRT)>=3*groupsd,"y","n"))%>%
  group_by(participant)%>%
  mutate(score=sum(grade=="correct")/sum(grade=="correct"|grade=="incorrect"))%>%
  mutate(outlier_participant=ifelse(abs(rt-groupmeanRT)>=3*groupsd,"y","n"))%>%
  filter(identifier%in%controls)%>%
  mutate(control_score=sum(grade=="correct")/sum(grade=="correct"|grade=="incorrect"))%>%
  select(participant,identifier,grade,control_score,score,outlier_item,outlier_participant)->examine
```

